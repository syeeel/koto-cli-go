# koto - ToDo管理CLIツール 基本設計書

## 1. プロジェクト概要

**koto**は、Goで開発されたインタラクティブなToDoリスト管理CLIツールです。
bubbletea フレームワークを使用して、リッチで直感的なターミナルUIを提供します。

## 2. 目的と目標

### 目的
- ターミナル環境でシームレスに使用できるToDoリスト管理ツールの提供
- 直感的で使いやすいインターフェースによる生産性の向上
- 軽量かつ高速な動作

### 目標
- Claude Codeのような専用画面での操作性を実現
- スラッシュコマンドによる直感的な操作
- ローカルストレージへのデータ永続化
- クロスプラットフォーム対応（Linux, macOS, Windows）

## 3. 主要機能

### 3.1 コマンド一覧

| コマンド | 機能 | 説明 |
|---------|------|------|
| `koto` | アプリ起動 | 専用画面に入り、インタラクティブモードを開始 |
| `/add` | ToDo追加 | 新しいToDoアイテムを追加 |
| `/edit` | ToDo編集 | 既存のToDoアイテムを編集 |
| `/delete` | ToDo削除 | ToDoアイテムを削除 |
| `/done` | ToDo完了 | ToDoアイテムを完了状態にする |
| `/list` | 一覧表示 | 全ToDoアイテムを一覧表示 |
| `/export` | エクスポート | ToDoデータをJSONファイルへエクスポート |
| `/import` | インポート | JSONファイルからToDoデータをインポート |
| `/pomo` | ポモドーロタイマー | 25分間のタイマーを開始（オプションでタスクIDを指定） |
| `/exit` | 終了 | アプリケーションを終了 |

### 3.2 機能詳細

#### ToDo管理機能
- ToDoアイテムの作成、編集、削除、完了
- ToDoアイテムの状態管理（未完了/完了）
- ToDoアイテムの優先度設定（オプション）
- ToDoアイテムの期限設定（オプション）

#### UI/UX機能
- リアルタイムなコマンド入力とフィードバック
- キーボードナビゲーション（矢印キー、Enter、Escなど）
- カラフルで視認性の高い表示
- レスポンシブなレイアウト

#### データ管理機能
- JSONファイルへのエクスポート（データ可搬性の確保）
- JSONファイルからのインポート（他環境からの移行、バックアップからの復元）
- 自動データベース初期化（初回起動時）

#### ポモドーロタイマー機能
- 25分間のカウントダウンタイマー
- タイマー終了時のアラーム通知
- タスク別の作業時間記録（累積時間の自動計算）
- 専用タイマー画面の表示
- タイマーのキャンセル機能

## 4. 技術スタック

### プログラミング言語
- **Go 1.21+**

### 主要ライブラリ
- **bubbletea**: TUIフレームワーク
- **bubbles**: bubbletea用のUIコンポーネント
- **lipgloss**: スタイリングライブラリ
- **modernc.org/sqlite**: データ永続化（Pure Go実装、CGO不要）

### 開発ツール
- Go modules: 依存関係管理
- golangci-lint: コード品質チェック
- go test: テストフレームワーク

## 5. システムアーキテクチャ概要

```
┌─────────────────────────────────────────┐
│           koto CLI Application          │
├─────────────────────────────────────────┤
│  Presentation Layer (Bubbletea)        │
│  ┌────────────────────────────────┐    │
│  │  Main Model (TUI State)        │    │
│  │  ├─ Command Parser             │    │
│  │  ├─ View Renderer              │    │
│  │  └─ Event Handler              │    │
│  └────────────────────────────────┘    │
├─────────────────────────────────────────┤
│  Business Logic Layer                  │
│  ┌────────────────────────────────┐    │
│  │  Todo Service                  │    │
│  │  ├─ Add                        │    │
│  │  ├─ Edit                       │    │
│  │  ├─ Delete                     │    │
│  │  ├─ Done                       │    │
│  │  └─ List                       │    │
│  └────────────────────────────────┘    │
├─────────────────────────────────────────┤
│  Data Access Layer                     │
│  ┌────────────────────────────────┐    │
│  │  Repository Interface          │    │
│  │  └─ SQLite Implementation     │    │
│  └────────────────────────────────┘    │
├─────────────────────────────────────────┤
│  Data Storage                          │
│  ┌────────────────────────────────┐    │
│  │  SQLite Database               │    │
│  │  (~/.koto/koto.db)             │    │
│  └────────────────────────────────┘    │
└─────────────────────────────────────────┘
```

## 6. データモデル概要

### ToDoアイテム
- **ID**: 一意識別子（自動生成）
- **Title**: タイトル（必須）
- **Description**: 説明（オプション）
- **Status**: ステータス（未完了/完了）
- **Priority**: 優先度（Low/Medium/High）（オプション）
- **DueDate**: 期限日時（オプション）
- **WorkDuration**: 累積作業時間（分）（ポモドーロタイマーで自動記録）
- **CreatedAt**: 作成日時（自動生成）
- **UpdatedAt**: 更新日時（自動更新）

## 7. UIフロー概要

```
[アプリ起動]
    ↓
[メイン画面]
    ├─ ToDo一覧表示
    │   └─ ↑/↓でタスクをフォーカス
    │       └─ 空入力でEnter → [タスク詳細画面] → [メイン画面]
    └─ コマンド入力エリア
        ↓
[コマンド入力]
    ├─ /add → [ToDo追加画面] → [メイン画面]
    ├─ /edit → [ToDo選択] → [編集画面] → [メイン画面]
    ├─ /delete → [ToDo選択] → [削除確認] → [メイン画面]
    ├─ /done → [ToDo選択] → [完了処理] → [メイン画面]
    ├─ /list → [一覧表示更新] → [メイン画面]
    ├─ /pomo → [ポモドーロタイマー画面] → [完了/キャンセル] → [メイン画面]
    └─ /quit → [アプリ終了]

[タスク詳細画面]
    ├─ タスクの全情報を表示（タイトル、説明、ステータス、優先度、作業時間、期限、作成日時、更新日時）
    ├─ Esc → [メイン画面]
    ├─ e → [編集画面] → [メイン画面]
    └─ d → タスク完了 → [メイン画面]
```

## 8. 非機能要件

### パフォーマンス
- アプリ起動時間: 1秒以内
- コマンド実行時間: 100ms以内
- 10,000件のToDoアイテムでもスムーズに動作

### セキュリティ
- データベースファイルはユーザーのホームディレクトリに保存
- ファイルパーミッション: 600（所有者のみ読み書き可能）

### 保守性
- モジュール化された設計
- 明確な責任分離
- 包括的なテストカバレッジ（80%以上）
- 詳細なドキュメント

### ユーザビリティ
- 直感的なコマンド体系
- ヘルプメッセージの充実
- エラーメッセージの明確化
- キーボードショートカットの提供

## 9. 配布方法

### 9.1 単一バイナリ配布
modernc.org/sqlite（Pure Go実装）を採用することで、以下の利点があります：
- **依存関係なし**: SQLiteライブラリがバイナリに含まれる
- **単一ファイル**: ユーザーは実行ファイル1つをダウンロードするだけ
- **クロスコンパイル対応**: Windows, macOS, Linuxの全プラットフォーム向けに容易にビルド可能

### 9.2 配布チャネル
- **GitHub Releases**: 各プラットフォーム向けのバイナリを提供
  - `koto-linux-amd64`
  - `koto-darwin-amd64` / `koto-darwin-arm64`
  - `koto-windows-amd64.exe`
- **Go install**: `go install github.com/yourusername/koto@latest`
- **Homebrew**: 将来的に対応予定

### 9.3 ビルド方法
```bash
# Pure Goなので、CGO不要でクロスコンパイルが簡単
CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -o koto-linux-amd64
CGO_ENABLED=0 GOOS=darwin GOARCH=arm64 go build -o koto-darwin-arm64
CGO_ENABLED=0 GOOS=windows GOARCH=amd64 go build -o koto-windows-amd64.exe
```

### 9.4 ユーザー体験
```bash
# ダウンロードして即実行可能（追加のインストール不要）
wget https://github.com/user/koto/releases/download/v1.0.0/koto-linux-amd64
chmod +x koto-linux-amd64
./koto-linux-amd64
```

## 10. SQLite採用の利点

### 10.1 データ永続化
- **信頼性**: トランザクション対応によるデータ整合性
- **パフォーマンス**: インデックスによる高速検索
- **スケーラビリティ**: 大量データ（数万件）でも性能劣化なし

### 10.2 データ可搬性の確保
SQLiteはバイナリ形式ですが、以下の方法でデータの可搬性を確保：
- `/export`コマンドによるJSON形式へのエクスポート
- `/import`コマンドによるJSON形式からのインポート
- バックアップ・移行が容易

### 10.3 将来の拡張容易性
SQLiteの強力なクエリ機能により、以下の機能を容易に実装可能：
- 複雑な検索・フィルタリング（タイトル、説明、タグの全文検索）
- 統計・分析（完了率、期限遵守率、優先度別集計）
- 高度なソート（複数条件、カスタムソート順）

## 11. 今後の拡張可能性

- タグ機能
- 高度なフィルタリング・検索機能（全文検索）
- カテゴリ分類
- 定期タスク（リカーリング）
- CSVエクスポート
- クラウド同期機能
- チーム共有機能
- ポモドーロタイマーの拡張
  - カスタマイズ可能なタイマー時間
  - 休憩時間のタイマー（5分/15分）
  - ポモドーロ回数の記録
  - 作業時間の統計・グラフ表示
  - 作業時間の目標設定
